import{J as C}from"./ActionMessage-86d2cefe.js";import{J as F}from"./ActionSection-96b34f83.js";import{J as S}from"./Button-c7c1269f.js";import{J as V}from"./SecondaryButton-0e4a566a.js";import{J as w}from"./DangerButton-cae1aa00.js";import{J as A}from"./ConfirmationModal-fc660ee4.js";import{J as I}from"./DialogModal-9ccdd4ea.js";import{J as N}from"./FormSection-fba54185.js";import{J as B}from"./Input-fd3ff2e6.js";import{J as M}from"./Checkbox-f9be08cc.js";import{J as k}from"./InputError-147afb17.js";import{J as E}from"./Label-9c529059.js";import{J as U}from"./SectionBorder-790e6c81.js";import{J as O}from"./ValidationErrors-62fdbd60.js";import{T as P}from"./TextField-0eb10881.js";import{M as q}from"./vue3-multiselect.umd.min-18b68693.js";import{a as b,r as _,o as h,b as G,w as d,g as f,t as s,d as o,e as p,f as v,h as L,F as T,n as c,j as R,v as j}from"./app-a7c937a1.js";import{s as y}from"./sweetalert.min-cf20c789.js";import{_ as z}from"./_plugin-vue_export-helper-c27b6911.js";import"./SectionTitle-57156eee.js";import"./Modal-d0d07394.js";const Q={components:{TextField:P,Multiselect:q,JetActionMessage:C,JetActionSection:F,JetButton:S,JetConfirmationModal:A,JetDangerButton:w,JetDialogModal:I,JetFormSection:N,JetInput:B,JetCheckbox:M,JetInputError:k,JetLabel:E,JetSecondaryButton:V,JetSectionBorder:U,JetValidationErrors:O},props:["modelValue"],data(){return{item:this.modelValue,count:1,units:[],items:[],taxTypes:[],taxSubtypes:[],taxSubtypes1:[],taxType:null,taxSubtype:null,showDlg:!1}},methods:{ShowDialog(){this.item=JSON.parse(JSON.stringify(this.modelValue)),this.item.dateTimeIssued=new Date().toISOString().slice(0,16),this.showDlg=!0},CancelDlg(){this.showDlg=!1},getDate(t){return new Date(t).toLocaleDateString()},updateValues(t){t.salesTotal=this.parse(t.quantity)*this.parse(t.unit_value.amountEGP),t.netTotal=t.salesTotal-this.parse(t.itemsDiscount),this.calculateTax(t),this.RecalculateTax()},parse(t){var e=parseFloat(t);return isNaN(e)&&(e=0),e},calculateTax(t){if(t.total=t.netTotal+0,t.taxable_items)for(var e=0;e<t.taxable_items.length;e++){var a=t.taxable_items[e];a.amount=a.rate*t.netTotal/100,a.taxType=="T4"?t.total-=a.amount:t.total+=a.amount}},RecalculateTax:function(){this.item.totalSalesAmount=0,this.item.totalDiscountAmount=0,this.item.netAmount=0,this.item.totalAmount=0,this.item.extraDiscountAmount=0,this.item.totalItemsDiscountAmount=0;var t={};this.item.taxTotals=[];for(var e=0;e<this.item.invoice_lines.length;e++){var a=this.item.invoice_lines[e];this.item.totalSalesAmount+=parseFloat(a.salesTotal),this.item.totalDiscountAmount+=parseFloat(a.itemsDiscount),this.item.netAmount+=parseFloat(a.netTotal),this.item.totalAmount+=parseFloat(a.total),this.item.extraDiscountAmount+=0,this.item.totalItemsDiscountAmount+=parseFloat(a.itemsDiscount);for(var i=0;i<a.taxable_items.length;i++){var l=a.taxable_items[i];l.taxType in t?t[l.taxType]=t[l.taxType.Code]+parseFloat(l.amount):t[l.taxType]=parseFloat(l.amount)}}for(let n of Object.keys(t))this.item.taxTotals.push({taxType:n,amount:t[n]})},getTaxlines(t){for(var e=0,a=0;a<t.taxable_items.length;a++){var i=t.taxable_items[a];e=e+parseFloat(i.amount)}return e},getTotalTax(){for(var t=0,e=0;e<this.item.invoice_lines.length;e++)for(var a=this.item.invoice_lines[e],i=0;i<a.taxable_items.length;i++){var l=a.taxable_items[i];t=t+parseFloat(l.amount)}return t},SubmitCreditNote(){b.post(route("eta.invoices.credit.store"),this.item).then(t=>{y({title:"Invoice Credit Note Saved!",icon:"success"})}).catch(t=>{y({title:"Invoice Credit Note Failed",icon:"error"})})},CopyItem(){b.post(route("invoices.copy"),{Id:this.item.Id}).then(t=>{y({title:"Invoice Was Copied",icon:"success"}),setTimeout(()=>{window.location.reload()},200)}).catch(t=>{console.error(t)})}},created:function(){}},W={class:"grid grid-cols-10 gap-0 mt-2"},H={class:"col-span-5"},K={class:"col-span-5"},X={class:"col-span-5"},Y={class:"grid grid-cols-10 gap-0 mt-2"},Z={class:"bg-gray-400 col-span-3"},$={class:"bg-gray-400 col-span-2"},tt={class:"bg-gray-400 col-span-1"},et={class:"bg-gray-400 col-span-1"},ot={class:"bg-gray-400 col-span-1"},st={class:"bg-gray-400 col-span-1"},at={class:"bg-gray-400 col-span-1"},lt={class:"bg-gray-400 col-span-5"},rt=o("div",{class:"bg-gray-400 col-span-1"},"****",-1),it=o("div",{class:"bg-gray-400 col-span-1"},"****",-1),nt={class:"bg-gray-400 col-span-1"},mt={class:"bg-gray-400 col-span-1"},ct={class:"bg-gray-400 col-span-1"},ut={class:"flex items-center justify-between mt-4"};function dt(t,e,a,i,l,n){const g=_("TextField"),J=_("jet-secondary-button"),D=_("jet-button"),x=_("jet-dialog-modal");return h(),G(x,{show:l.showDlg,"max-width":"5xl",onClose:e[3]||(e[3]=r=>l.showDlg=!1)},{title:d(()=>[f(s(t.__("Invoice Credit Note")),1)]),content:d(()=>[o("div",W,[o("div",H,s(t.__("Branch"))+": "+s(l.item.issuer.name),1),o("div",K,s(t.__("Customer"))+": "+s(l.item.receiver.name),1),o("div",X,[p(g,{modelValue:l.item.dateTimeIssued,"onUpdate:modelValue":e[0]||(e[0]=r=>l.item.dateTimeIssued=r),itemType:"datetime-local",itemLabel:t.__("Invoice Date")},null,8,["modelValue","itemLabel"])])]),o("div",Y,[o("div",Z,s(t.__("Item")),1),o("div",$,s(t.__("Code")),1),o("div",tt,s(t.__("Quantity")),1),o("div",et,s(t.__("Unit Price")),1),o("div",ot,s(t.__("Sales")),1),o("div",st,s(t.__("Tax")),1),o("div",at,s(t.__("Total")),1),(h(!0),v(T,null,L(l.item.invoice_lines,(r,m)=>(h(),v(T,{key:m},[o("div",{class:c(["col-span-3",{"bg-gray-200":m%2==1}])},s(r.description),3),o("div",{class:c(["col-span-2",{"bg-gray-200":m%2==1}])},s(r.itemCode),3),o("div",{class:c(["col-span-1",{"bg-gray-200":m%2==1}])},[p(g,{modelValue:r.quantity,"onUpdate:modelValue":[u=>r.quantity=u,u=>n.updateValues(r)],itemType:"number"},null,8,["modelValue","onUpdate:modelValue"])],2),o("div",{class:c(["col-span-1",{"bg-gray-200":m%2==1}])},[p(g,{modelValue:r.unit_value.amountEGP,"onUpdate:modelValue":[u=>r.unit_value.amountEGP=u,u=>n.updateValues(r)],itemType:"number"},null,8,["modelValue","onUpdate:modelValue"])],2),o("div",{class:c(["col-span-1",{"bg-gray-200":m%2==1}])},s((Math.round(100*r.salesTotal)/100).toFixed(2)),3),o("div",{class:c(["col-span-1",{"bg-gray-200":m%2==1}])},s(n.getTaxlines(r).toFixed(2)),3),o("div",{class:c(["col-span-1",{"bg-gray-200":m%2==1}])},s((Math.round(100*r.total)/100).toFixed(2)),3)],64))),128)),o("div",lt,s(t.__("Summary")),1),rt,it,o("div",nt,s((Math.round(100*l.item.totalSalesAmount)/100).toFixed(2)),1),o("div",mt,s(n.getTotalTax().toFixed(2)),1),o("div",ct,s((Math.round(100*l.item.totalAmount)/100).toFixed(2)),1)])]),footer:d(()=>[o("div",ut,[p(J,{onClick:e[1]||(e[1]=r=>n.CancelDlg())},{default:d(()=>[f(s(t.__("Close")),1)]),_:1}),R(o("div",null,[p(D,{class:"ms-2",onClick:e[2]||(e[2]=r=>n.SubmitCreditNote())},{default:d(()=>[f(s(t.__("Approve")),1)]),_:1})],512),[[j,l.item.status=="Valid"]])])]),_:1},8,["show"])}const Mt=z(Q,[["render",dt]]);export{Mt as default};
